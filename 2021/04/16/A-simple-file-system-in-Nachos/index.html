<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"co10.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="We define two separate implementations of the file system.  The “STUB” version just re-defines the Nachos file system operations as operations on the native UNIX file system on the machine running th">
<meta property="og:type" content="article">
<meta property="og:title" content="A simple file system in Nachos">
<meta property="og:url" content="co10.github.io/2021/04/16/A-simple-file-system-in-Nachos/index.html">
<meta property="og:site_name" content="荒芜知地">
<meta property="og:description" content="We define two separate implementations of the file system.  The “STUB” version just re-defines the Nachos file system operations as operations on the native UNIX file system on the machine running th">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-16T01:40:52.000Z">
<meta property="article:modified_time" content="2021-04-18T11:45:51.476Z">
<meta property="article:author" content="K">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="co10.github.io/2021/04/16/A-simple-file-system-in-Nachos/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>A simple file system in Nachos | 荒芜知地</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="荒芜知地" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">荒芜知地</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Knowhere</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">45</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">89</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="co10.github.io/2021/04/16/A-simple-file-system-in-Nachos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="K">
      <meta itemprop="description" content="You know Knowhere is nowhere, but KnowWhere.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="荒芜知地">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          A simple file system in Nachos
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-16 09:40:52" itemprop="dateCreated datePublished" datetime="2021-04-16T09:40:52+08:00">2021-04-16</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/04/16/A-simple-file-system-in-Nachos/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/04/16/A-simple-file-system-in-Nachos/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>We define two separate implementations of the file system. </p>
<p>The “STUB” version just re-defines the Nachos file system operations as operations on the native UNIX file system on the machine running the Nachos simulation.  This is provided in case the multiprogramming and virtual memory assignments (which make use of the file system) are done before the file system assignment.</p>
<p>The other version is a “real” file system, built on top of a disk simulator.  The disk is simulated using the native UNIX file system (in a file named “DISK”). </p>
<p>In the “real” implementation, there are two key data structures used in the file system. There is a single “root” directory, listing all of the files in the file system; unlike UNIX, the baseline system does not provide a hierarchical directory structure. In addition, there is a bitmap for allocating disk sectors. Both the root directory and the bitmap are themselves stored as files in the Nachos file system — this causes an interesting bootstrap problem when the simulated disk is initialized. </p>
</blockquote>
<a id="more"></a>
<p>In <code>filesys.h</code> in <code>filesys</code> directory, we see:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> FILESYS_STUB 	<span class="comment">// Temporarily implement file system calls as </span></span></span><br><span class="line">				<span class="comment">// calls to UNIX, until the real file system implementation is available</span></span><br><span class="line"><span class="comment">// ...............................</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">// FILESYS</span></span></span><br><span class="line"><span class="comment">// ...............................</span></span><br></pre></td></tr></table></figure>
<p>Grep to see: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# grep FILESYS_STUB *</span><br><span class="line">grep: arch: Is a directory</span><br><span class="line">filesys.h:#ifdef FILESYS_STUB           // Temporarily implement file system calls as </span><br><span class="line">Makefile.local:DEFINES := $(DEFINES:FILESYS_STUB=FILESYS)</span><br><span class="line">openfile.h:#ifdef FILESYS_STUB                  // Temporarily implement calls to </span><br><span class="line">grep: test: Is a directory</span><br></pre></td></tr></table></figure>
<p><code>FILESYS_STUB</code> is not defined, so it uses <code>FILESYS</code> . </p>
<h2 id="Reading-Code"><a href="#Reading-Code" class="headerlink" title="Reading Code"></a>Reading Code</h2><h3 id="Disk-Manager"><a href="#Disk-Manager" class="headerlink" title="Disk Manager"></a>Disk Manager</h3><p>Code in <code>machine</code> directory.</p>
<h4 id="disk-cc"><a href="#disk-cc" class="headerlink" title="disk.cc"></a><code>disk.cc</code></h4><p>In first few lines we see:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MagicNumber		0x456789ab</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MagicSize		sizeof(int)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DiskSize		(MagicSize + (NumSectors * SectorSize))</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Disk::Disk(<span class="keyword">char</span>* name, VoidFunctionPtr callWhenDone, _int callArg) &#123;</span><br><span class="line">    <span class="keyword">int</span> magicNum;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    DEBUG(<span class="string">'d'</span>, <span class="string">"Initializing the disk, 0x%x 0x%x\n"</span>, callWhenDone, callArg);</span><br><span class="line">    handler = callWhenDone;</span><br><span class="line">    handlerArg = callArg;</span><br><span class="line">    lastSector = <span class="number">0</span>;</span><br><span class="line">    bufferInit = <span class="number">0</span>;</span><br><span class="line">    fileno = OpenForReadWrite(name, FALSE);</span><br><span class="line">    <span class="keyword">if</span> (fileno &gt;= <span class="number">0</span>) &#123;		<span class="comment">// file exists, check magic number </span></span><br><span class="line">        Read(fileno, (<span class="keyword">char</span> *) &amp;magicNum, MagicSize);</span><br><span class="line">		ASSERT(magicNum == MagicNumber);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;				<span class="comment">// file doesn't exist, create it</span></span><br><span class="line">        fileno = OpenForWrite(name);</span><br><span class="line">		magicNum = MagicNumber;  </span><br><span class="line">		WriteFile(fileno, (<span class="keyword">char</span> *) &amp;magicNum, MagicSize); <span class="comment">// write magic number</span></span><br><span class="line">		<span class="comment">// need to write at end of file, so that reads will not return EOF</span></span><br><span class="line">        Lseek(fileno, DiskSize - <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);	</span><br><span class="line">		WriteFile(fileno, (<span class="keyword">char</span> *)&amp;tmp, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));  </span><br><span class="line">    &#125;</span><br><span class="line">    active = FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And also see define in <code>disk.h</code> :</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define SectorSize 		128	&#x2F;&#x2F; number of bytes per disk sector</span><br><span class="line">#define SectorsPerTrack 32	&#x2F;&#x2F; number of sectors per disk track </span><br><span class="line">#define NumTracks 		32	&#x2F;&#x2F; number of tracks per disk</span><br><span class="line">#define NumSectors 		(SectorsPerTrack * NumTracks)</span><br></pre></td></tr></table></figure>
<p>The first 4 bytes is <code>MagicNumber</code> (<code>sizeof (int)</code> , which is 4 bytes in both 32-bit and 64-bit systems) , implying that this is a Nachos Disk. The <code>NumSectors * SectorSize</code> is $(32\times32)\times128$ , every sector is 128 bytes. So the No. 0 Sector starts from 4, ends with 131.</p>
<p>And the Disk size is $4+1024\times128=128{\rm KB}={\rm 0x80KB}$ .</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Disk::ReadRequest</span><span class="params">(<span class="keyword">int</span> sectorNumber, <span class="keyword">char</span>* data)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Disk::WriteRequest</span><span class="params">(<span class="keyword">int</span> sectorNumber, <span class="keyword">char</span>* data)</span></span></span><br></pre></td></tr></table></figure>
<p>The two operations are similar: calculate how long it takes by its size, check if it’s ready then seek its sector and then read/write, update the sector position, report status and then open interrupt.</p>
<h3 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h3><p>The code is in <code>filesys</code> directory.</p>
<h4 id="filehdr-h"><a href="#filehdr-h" class="headerlink" title="filehdr.h"></a><code>filehdr.h</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHeader</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> numBytes;				<span class="comment">// Number of bytes in the file</span></span><br><span class="line">	<span class="keyword">int</span> numSectors;				<span class="comment">// Number of data sectors in the file</span></span><br><span class="line">	<span class="keyword">int</span> dataSectors[NumDirect];	<span class="comment">// Disk sector numbers for each data block in the file</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>We see three things in file header: the size of the file in bytes, how many sectors the file locates, and which sector each block of the file locates.</p>
<h4 id="filesys-cc"><a href="#filesys-cc" class="headerlink" title="filesys.cc"></a><code>filesys.cc</code></h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">FileSystem</span>::<span class="built_in">FileSystem</span>(<span class="keyword">bool</span> format)</span><br></pre></td></tr></table></figure>
<p>If <code>format</code> is true, it means the file system needs to be formatted: new <code>BitMap</code>, new <code>Directory</code>, associated with the file header. If not, just open the files representing the bitmap and directory. </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">FileSystem::Create</span><span class="params">(<span class="keyword">char</span> *name, <span class="keyword">int</span> initialSize)</span></span></span><br></pre></td></tr></table></figure>
<p>It creates a new file with a new sector and some space with a filename, failed if filename already exists or no free entry or no free space. The default directory entry is 10.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">OpenFile * <span class="title">FileSystem::Open</span><span class="params">(<span class="keyword">char</span> *name)</span></span></span><br></pre></td></tr></table></figure>
<p>It first finds the file from directory, the result returns its sector. If not found, return null.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">FileSystem</span>::Remove(<span class="keyword">char</span> *name)</span><br></pre></td></tr></table></figure>
<p>It deletes the space for its header, along with the space. And write back the change to directory, bitmap. Return TRUE if the file was deleted, FALSE if the file wasn’t in the file system.</p>
<h4 id="directory-h"><a href="#directory-h" class="headerlink" title="directory.h"></a><code>directory.h</code></h4><blockquote>
<p>The directory is a table of fixed length entries. Each entry represents a single file, and contains the file name, and the location of the file header on disk.</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DirectoryEntry</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">bool</span> inUse;						<span class="comment">// Is this directory entry in use?</span></span><br><span class="line">	<span class="keyword">int</span> sector;						<span class="comment">// Location on disk to find the FileHeader for this file </span></span><br><span class="line">	<span class="keyword">char</span> name[FileNameMaxLen + <span class="number">1</span>];	<span class="comment">// Text name for file, with +1 for the trailing '\0'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Directory</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> tableSize;				<span class="comment">// Number of directory entries</span></span><br><span class="line">	DirectoryEntry *table;		<span class="comment">// Table of pairs:  &lt;file name, file header location&gt; </span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">FindIndex</span><span class="params">(<span class="keyword">char</span> *name)</span></span>;	<span class="comment">// Find the index into the directory table corresponding to "name"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>So the directory is a 1-D array which contains the entries representing a file. </p>
<h3 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h3><p>In <code>main.cc</code> in <code>threads</code> directory : </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> FILESYS</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-cp"</span>)) &#123; 		<span class="comment">// copy from UNIX to Nachos</span></span><br><span class="line">	    ASSERT(argc &gt; <span class="number">2</span>);</span><br><span class="line">	    Copy(*(argv + <span class="number">1</span>), *(argv + <span class="number">2</span>));</span><br><span class="line">	    argCount = <span class="number">3</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-p"</span>)) &#123;	<span class="comment">// print a Nachos file</span></span><br><span class="line">	    ASSERT(argc &gt; <span class="number">1</span>);</span><br><span class="line">	    Print(*(argv + <span class="number">1</span>));</span><br><span class="line">	    argCount = <span class="number">2</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-r"</span>)) &#123;	<span class="comment">// remove Nachos file</span></span><br><span class="line">	    ASSERT(argc &gt; <span class="number">1</span>);</span><br><span class="line">	    fileSystem-&gt;Remove(*(argv + <span class="number">1</span>));</span><br><span class="line">	    argCount = <span class="number">2</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-l"</span>)) &#123;	<span class="comment">// list Nachos directory</span></span><br><span class="line">            fileSystem-&gt;List();</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-D"</span>)) &#123;	<span class="comment">// print entire filesystem</span></span><br><span class="line">            fileSystem-&gt;Print();</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(*argv, <span class="string">"-t"</span>)) &#123;	<span class="comment">// performance test</span></span><br><span class="line">            PerformanceTest();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// FILESYS</span></span></span><br></pre></td></tr></table></figure>
<p><code>-cp</code> : copy a file to Nachos, similar to <code>cp</code> . <code>-cp (from) (to)</code> , copy a file in the host system, to somewhere in Nachos file system, also rename it.</p>
<p><code>-p</code> : print the contents of a file, similar to <code>cat</code> . <code>-p filename</code> .</p>
<p><code>-r</code> : remove a file by filename, similar to <code>rm</code> . <code>-r filename</code> .</p>
<p><code>-l</code> : list all the filenames in the current directory, similar to <code>ls</code> . </p>
<p><code>-D</code> : print the entire file system info. </p>
<p><code>-t</code> : performance test.</p>
<p>and also -f , which I can’t find where it is: </p>
<p><code>-f</code> : causes the physical disk to be formatted. </p>
<h3 id="The-Unix-commands"><a href="#The-Unix-commands" class="headerlink" title="The Unix commands"></a>The Unix commands</h3><p><code>od</code> : Octal Dump. Displays a file in <strong>octal</strong> (<strong>base 8</strong>) format by default.</p>
<p><code>hexdump</code> : Hexadecimal Dump. Displays the contents of binary files in hexadecimal, decimal, octal, or ASCII.</p>
<h2 id="The-experiment"><a href="#The-experiment" class="headerlink" title="The experiment"></a>The experiment</h2><h3 id="Test-file"><a href="#Test-file" class="headerlink" title="Test file"></a>Test file</h3><p>In <code>filesys/test</code> , there are three test files, test them: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# od test/small</span><br><span class="line">0000000 064124 071551 064440 020163 064164 020145 070163 064562</span><br><span class="line">0000020 063556 067440 020146 072557 020162 064544 061563 067157</span><br><span class="line">0000040 062564 072156 005056</span><br><span class="line">0000046</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -c test/small</span><br><span class="line">0000000   T   h   i   s       i   s       t   h   e       s   p   r   i</span><br><span class="line">0000010   n   g       o   f       o   u   r       d   i   s   c   o   n</span><br><span class="line">0000020   t   e   n   t   .  \n                                        </span><br><span class="line">0000026</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -C test/small</span><br><span class="line">00000000  54 68 69 73 20 69 73 20  74 68 65 20 73 70 72 69  |This is the spri|</span><br><span class="line">00000010  6e 67 20 6f 66 20 6f 75  72 20 64 69 73 63 6f 6e  |ng of our discon|</span><br><span class="line">00000020  74 65 6e 74 2e 0a                                 |tent..|</span><br><span class="line">00000026</span><br></pre></td></tr></table></figure>
<p>Also do the same to <code>medium</code> and <code>big</code> if you interest.</p>
<h3 id="The-Nachos-file-system"><a href="#The-Nachos-file-system" class="headerlink" title="The Nachos file system"></a>The Nachos file system</h3><p>In <code>filesys</code> directory, <code>make</code> . Then do the follow: </p>
<ol>
<li><p>Initialize the Disk. </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# ./nachos -f</span><br></pre></td></tr></table></figure>
</li>
<li><p>Show the disk info.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./nachos -D</span><br><span class="line">*** thread 0 looped 0 times</span><br><span class="line">*** thread 1 looped 0 times</span><br><span class="line">*** thread 0 looped 1 times</span><br><span class="line">*** thread 1 looped 1 times</span><br><span class="line">*** thread 0 looped 2 times</span><br><span class="line">*** thread 1 looped 2 times</span><br><span class="line">*** thread 0 looped 3 times</span><br><span class="line">*** thread 1 looped 3 times</span><br><span class="line">*** thread 0 looped 4 times</span><br><span class="line">*** thread 1 looped 4 times</span><br><span class="line">Bit map file header:</span><br><span class="line">FileHeader contents.  File size: 128.  File blocks:</span><br><span class="line">2 </span><br><span class="line">File contents:</span><br><span class="line">\1f\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">Directory file header:</span><br><span class="line">FileHeader contents.  File size: 200.  File blocks:</span><br><span class="line">3 4 </span><br><span class="line">File contents:</span><br><span class="line">\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">Bitmap set:</span><br><span class="line">0, 1, 2, 3, 4, </span><br><span class="line">Directory contents:</span><br><span class="line"></span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br><span class="line">Assuming the program completed.</span><br><span class="line">Machine halting!</span><br><span class="line"></span><br><span class="line">Ticks: total 5420, idle 4990, system 430, user 0</span><br><span class="line">Disk I/O: reads 10, writes 0</span><br><span class="line">Console I/O: reads 0, writes 0</span><br><span class="line">Paging: faults 0</span><br><span class="line">Network I/O: packets received 0, sent 0</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run <code>OD</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# od DISK</span><br><span class="line">0000000 104653 042547 000200 000000 000001 000000 000002 000000</span><br><span class="line">0000020 000000 000000 000000 000000 000000 000000 000000 000000</span><br><span class="line">*</span><br><span class="line">0000200 000000 000000 000310 000000 000002 000000 000003 000000</span><br><span class="line">0000220 000004 000000 000000 000000 000000 000000 000000 000000</span><br><span class="line">0000240 000000 000000 000000 000000 000000 000000 000000 000000</span><br><span class="line">*</span><br><span class="line">0000400 000000 000000 000037 000000 000000 000000 000000 000000</span><br><span class="line">0000420 000000 000000 000000 000000 000000 000000 000000 000000</span><br><span class="line">*</span><br><span class="line">0400000 000000 000000</span><br><span class="line">0400004</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run <code>hexdump</code> :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -c DISK</span><br><span class="line">0000000   � 211   g   E 200  \0  \0  \0 001  \0  \0  \0 002  \0  \0  \0</span><br><span class="line">0000010  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000080  \0  \0  \0  \0   �  \0  \0  \0 002  \0  \0  \0 003  \0  \0  \0</span><br><span class="line">0000090 004  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">00000a0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0000100  \0  \0  \0  \0 037  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">0000110  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0</span><br><span class="line">*</span><br><span class="line">0020004</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -C DISK</span><br><span class="line">00000000  ab 89 67 45 80 00 00 00  01 00 00 00 02 00 00 00  |..gE............|</span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000080  00 00 00 00 c8 00 00 00  02 00 00 00 03 00 00 00  |................|</span><br><span class="line">00000090  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000100  00 00 00 00 1f 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00020004</span><br></pre></td></tr></table></figure>
<p>Clearly we see nothing but the initial info.</p>
</li>
<li><p>Copy <code>small</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# ./nachos -cp test/small small</span><br></pre></td></tr></table></figure>
<p>Check it by <code>list</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# ./nachos -l</span><br><span class="line">*** thread 0 looped 0 times</span><br><span class="line">*** thread 1 looped 0 times</span><br><span class="line">*** thread 0 looped 1 times</span><br><span class="line">*** thread 1 looped 1 times</span><br><span class="line">*** thread 0 looped 2 times</span><br><span class="line">*** thread 1 looped 2 times</span><br><span class="line">*** thread 0 looped 3 times</span><br><span class="line">*** thread 1 looped 3 times</span><br><span class="line">*** thread 0 looped 4 times</span><br><span class="line">*** thread 1 looped 4 times</span><br><span class="line">small</span><br></pre></td></tr></table></figure>
<p>We see the filename: small. </p>
</li>
<li><p>Check the <code>DISK</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -C DISK</span><br><span class="line">00000000  ab 89 67 45 80 00 00 00  01 00 00 00 02 00 00 00  |..gE............|</span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000080  00 00 00 00 c8 00 00 00  02 00 00 00 03 00 00 00  |................|</span><br><span class="line">00000090  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000100  00 00 00 00 7f 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000180  00 00 00 00 01 00 00 00  05 00 00 00 73 6d 61 6c  |............smal|</span><br><span class="line">00000190  6c 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |l...............|</span><br><span class="line">000001a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000280  00 00 00 00 26 00 00 00  01 00 00 00 06 00 00 00  |....&amp;...........|</span><br><span class="line">00000290  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000300  00 00 00 00 54 68 69 73  20 69 73 20 74 68 65 20  |....This is the |</span><br><span class="line">00000310  73 70 72 69 6e 67 20 6f  66 20 6f 75 72 20 64 69  |spring of our di|</span><br><span class="line">00000320  73 63 6f 6e 74 65 6e 74  2e 0a 00 00 00 00 00 00  |scontent........|</span><br><span class="line">00000330  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00020004</span><br></pre></td></tr></table></figure>
<p>from <code>0x184</code>: <code>01 00 00 00  05 00 00 00 73 6d 61 6c 6c</code><br><code>0x01</code> stands for the sector is in use, <code>0x05</code> stands for the contents is in Sector 5, <code>0x736d616c6c</code> is the ASCII code for its file name. </p>
</li>
<li><p>Remove <code>small</code> :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# ./nachos -r small</span><br></pre></td></tr></table></figure>
<p>Check it by <code>list</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./nachos -l</span><br><span class="line">*** thread 0 looped 0 times</span><br><span class="line">*** thread 1 looped 0 times</span><br><span class="line">*** thread 0 looped 1 times</span><br><span class="line">*** thread 1 looped 1 times</span><br><span class="line">*** thread 0 looped 2 times</span><br><span class="line">*** thread 1 looped 2 times</span><br><span class="line">*** thread 0 looped 3 times</span><br><span class="line">*** thread 1 looped 3 times</span><br><span class="line">*** thread 0 looped 4 times</span><br><span class="line">*** thread 1 looped 4 times</span><br><span class="line">No threads ready or runnable, and no pending interrupts.</span><br></pre></td></tr></table></figure>
<p>Removed.</p>
</li>
<li><p>Check the <code>DISK</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# hexdump -C DISK</span><br><span class="line">00000000  ab 89 67 45 80 00 00 00  01 00 00 00 02 00 00 00  |..gE............|</span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000080  00 00 00 00 c8 00 00 00  02 00 00 00 03 00 00 00  |................|</span><br><span class="line">00000090  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000100  00 00 00 00 1f 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000180  00 00 00 00 00 00 00 00  05 00 00 00 73 6d 61 6c  |............smal|</span><br><span class="line">00000190  6c 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |l...............|</span><br><span class="line">000001a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000280  00 00 00 00 26 00 00 00  01 00 00 00 06 00 00 00  |....&amp;...........|</span><br><span class="line">00000290  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000300  00 00 00 00 54 68 69 73  20 69 73 20 74 68 65 20  |....This is the |</span><br><span class="line">00000310  73 70 72 69 6e 67 20 6f  66 20 6f 75 72 20 64 69  |spring of our di|</span><br><span class="line">00000320  73 63 6f 6e 74 65 6e 74  2e 0a 00 00 00 00 00 00  |scontent........|</span><br><span class="line">00000330  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00020004</span><br></pre></td></tr></table></figure>
<p>We see <code>inuse</code> is set to 0, but the contents remain. </p>
</li>
<li><p>Do the same for <code>medium</code> : </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/OS/filesys# ./nachos -cp test/medium medium</span><br><span class="line">~/OS/filesys# hexdump -C DISK</span><br><span class="line">00000000  ab 89 67 45 80 00 00 00  01 00 00 00 02 00 00 00  |..gE............|</span><br><span class="line">00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000080  00 00 00 00 c8 00 00 00  02 00 00 00 03 00 00 00  |................|</span><br><span class="line">00000090  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000100  00 00 00 00 ff 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000180  00 00 00 00 01 00 00 00  05 00 00 00 6d 65 64 69  |............medi|</span><br><span class="line">00000190  75 6d 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |um..............|</span><br><span class="line">000001a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000280  00 00 00 00 98 00 00 00  02 00 00 00 06 00 00 00  |................|</span><br><span class="line">00000290  07 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000002a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00000300  00 00 00 00 54 68 69 73  20 69 73 20 74 68 65 20  |....This is the |</span><br><span class="line">00000310  73 70 72 69 6e 67 20 6f  66 20 6f 75 72 20 64 69  |spring of our di|</span><br><span class="line">00000320  73 63 6f 6e 74 65 6e 74  2e 0a 54 68 69 73 20 69  |scontent..This i|</span><br><span class="line">00000330  73 20 74 68 65 20 73 70  72 69 6e 67 20 6f 66 20  |s the spring of |</span><br><span class="line">00000340  6f 75 72 20 64 69 73 63  6f 6e 74 65 6e 74 2e 0a  |our discontent..|</span><br><span class="line">00000350  54 68 69 73 20 69 73 20  74 68 65 20 73 70 72 69  |This is the spri|</span><br><span class="line">00000360  6e 67 20 6f 66 20 6f 75  72 20 64 69 73 63 6f 6e  |ng of our discon|</span><br><span class="line">00000370  74 65 6e 74 2e 0a 54 68  69 73 20 69 73 20 74 68  |tent..This is th|</span><br><span class="line">00000380  65 20 73 70 72 69 6e 67  20 6f 66 20 6f 75 72 20  |e spring of our |</span><br><span class="line">00000390  64 69 73 63 6f 6e 74 65  6e 74 2e 0a 00 00 00 00  |discontent......|</span><br><span class="line">000003a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">*</span><br><span class="line">00020004</span><br></pre></td></tr></table></figure>
<p>It covers the sector not used by <code>small</code>. </p>
</li>
</ol>
<p>Also big can be tested, but I don’t list the code because it just does the same thing. The result leading to thinking matters.</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/06/Sync-in-Nachos/" rel="prev" title="Sync in Nachos">
      <i class="fa fa-chevron-left"></i> Sync in Nachos
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/05/02/Append-in-Nachos-FIle-System/" rel="next" title="Append() in Nachos FIle System">
      Append() in Nachos FIle System <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reading-Code"><span class="nav-number">1.</span> <span class="nav-text">Reading Code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Disk-Manager"><span class="nav-number">1.1.</span> <span class="nav-text">Disk Manager</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#disk-cc"><span class="nav-number">1.1.1.</span> <span class="nav-text">disk.cc</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-System"><span class="nav-number">1.2.</span> <span class="nav-text">File System</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#filehdr-h"><span class="nav-number">1.2.1.</span> <span class="nav-text">filehdr.h</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filesys-cc"><span class="nav-number">1.2.2.</span> <span class="nav-text">filesys.cc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#directory-h"><span class="nav-number">1.2.3.</span> <span class="nav-text">directory.h</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Commands"><span class="nav-number">1.3.</span> <span class="nav-text">Commands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Unix-commands"><span class="nav-number">1.4.</span> <span class="nav-text">The Unix commands</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-experiment"><span class="nav-number">2.</span> <span class="nav-text">The experiment</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-file"><span class="nav-number">2.1.</span> <span class="nav-text">Test file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Nachos-file-system"><span class="nav-number">2.2.</span> <span class="nav-text">The Nachos file system</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">K</p>
  <div class="site-description" itemprop="description">You know Knowhere is nowhere, but KnowWhere.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:colivener@outlook.com" title="E-Mail → mailto:colivener@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>



    <div class="links-of-blogroll motion-element links-of-blogroll-undefined">
      <div class="links-of-blogroll-title">
        <!-- modify icon to fire by szw -->
        <i class="fa fa-history fa-" aria-hidden="true"></i>
        
      </div>
      <ul class="links-of-blogroll-list">
        
        
          <li>
            <a href="/" title="" target="_blank"></a>
          </li>
        
          <li>
            <a href="/" title="" target="_blank"></a>
          </li>
        
          <li>
            <a href="/" title="" target="_blank"></a>
          </li>
        
          <li>
            <a href="/" title="" target="_blank"></a>
          </li>
        
          <li>
            <a href="/" title="" target="_blank"></a>
          </li>
        
      </ul>
    </div>


    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">K</span>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e9ea4a022889786" async="async"></script>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'nydWvj5q5w14PIVolKD4JOtS-MdYXbMMI',
      appKey     : '7vFccLCEXIsFn1VxvpyQAibm',
      placeholder: "knowhere to know here",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
